<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasktory</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div id="infoBar" class="info-bar" style="display: none;">
            ğŸ’¡ Browser Mode: Data is stored in local storage. Use Electron mode for always-on-top functionality.
        </div>
        
        <header>
            <div class="header-left">
                <h1>Tasktory</h1>
            </div>
            <div class="header-buttons">
                <button id="exportBtn" class="btn icon-btn" title="">ğŸ’¾</button>
                <button id="importBtn" class="btn icon-btn" title="">ğŸ“‚</button>
                <button id="statisticsBtn" class="btn icon-btn" title="">ğŸ“Š</button>
                <button id="settingsBtn" class="btn icon-btn" title="">âš™ï¸</button>
                <button id="aboutBtn" class="btn icon-btn" title="">â„¹ï¸</button>
                <button id="collapseBtn" class="btn icon-btn" title="Toggle ultra-compact mode (Ctrl+M)">â†—ï¸</button>
            </div>
        </header>
        
        <main>
            <div class="completion-counter-container">
                <div id="completionCounter" class="completion-counter">
                    <span id="completionCounterText">Completed</span> <span id="completionCount" class="completion-count">0</span>
                </div>
            </div>
            <div class="table-controls">
                <div class="controls-right">
                    <div class="search-container">
                        <input type="text" id="searchInput" placeholder="" class="search-input">
                        <button id="clearSearchBtn" class="btn clear-search-btn" title="Clear search">âœ•</button>
                    </div>
                    <button id="addTaskBtn" class="btn icon-btn add-btn" title="">âœš</button>
                </div>
            </div>
            <div class="table-container">
                <table id="tasksTable">
                    <thead>
                        <tr>
                            <th id="thNumber">#</th>
                            <th id="thStartTime">Start Time</th>
                            <th id="thTargetTime">Target Time</th>
                            <th id="thTags">Tags</th>
                            <th id="thTaskContent">Task Content</th>
                            <th id="thStatus">Status</th>
                            <th id="thActions">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tasksBody">
                        <!-- Dynamically generated task list -->
                    </tbody>
                </table>
                
                <!-- Collapsed view -->
                <div id="collapsedTaskList" class="collapsed-task-list" style="display: none;">
                    <ul id="collapsedTasksBody">
                        <!-- Collapsed task items -->
                    </ul>
                </div>
                
                <!-- Pagination -->
                <div id="paginationContainer" class="pagination-container">
                    <div class="pagination">
                        <button id="prevPageBtn" class="pagination-btn">â€¹</button>
                        <div id="pageNumbers" class="page-numbers"></div>
                        <button id="nextPageBtn" class="pagination-btn">â€º</button>
                    </div>
                </div>
            </div>
            
            <!-- Collapsed Mini Layout (100px width) -->
            <div id="collapsedMiniLayout" class="collapsed-mini-layout">
                <button id="collapsedExpandBtn" class="collapsed-expand-btn" title="Expand">â†™ï¸</button>
                <div id="collapsedCompletionCounter" class="collapsed-completion-counter">0</div>
                <div class="collapsed-task-list">
                    <ul id="collapsedMiniTasksBody">
                        <!-- Mini collapsed task items -->
                    </ul>
                </div>
            </div>
        </main>
    </div>

    <!-- Task Add/Edit Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalTitle"></h2>
            <form id="taskForm">
                <div class="form-group">
                    <label for="taskPosition" id="labelPosition">Position:</label>
                    <input type="number" id="taskPosition" min="1" placeholder="Position in list">
                </div>
                <div class="form-group">
                    <label for="startDateTime" id="labelStartTime">Start Time:</label>
                    <input type="datetime-local" id="startDateTime" required>
                </div>
                <div class="form-group">
                    <label for="targetDateTime" id="labelTargetTime">Target Time:</label>
                    <input type="datetime-local" id="targetDateTime" required>
                </div>
                <div class="form-group">
                    <label for="taskTags" id="labelTags">Tags:</label>
                    <div class="tags-input-container">
                        <div id="tagPresets" class="tag-presets"></div>
                        <input type="text" id="taskTags" placeholder="">
                    </div>
                </div>
                <div class="form-group">
                    <label for="taskContent" id="labelTaskContent">Task Content:</label>
                    <textarea id="taskContent" rows="3" required placeholder=""></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" id="cancelBtn"></button>
                    <button type="submit" id="saveBtn"></button>
                </div>
            </form>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close" data-modal="settings">&times;</span>
            <h2>Settings</h2>
            
            <div class="settings-group">
                <label>Theme Mode</label>
                <div class="theme-toggle">
                    <button id="lightModeBtn" class="theme-btn active" title="Light Mode">â˜€ï¸</button>
                    <button id="darkModeBtn" class="theme-btn" title="Dark Mode">ğŸŒ™</button>
                </div>
            </div>
            
            <div class="settings-group">
                <label>Default Notification</label>
                <div class="notification-toggle">
                    <button id="notificationOnBtn" class="notification-btn active" title="Notifications On">ğŸ””</button>
                    <button id="notificationOffBtn" class="notification-btn" title="Notifications Off">ğŸ”•</button>
                </div>
            </div>
            
            <div class="settings-group">
                <label for="settingsOpacitySlider">Unfocused Opacity</label>
                <input type="range" id="settingsOpacitySlider" min="0.3" max="1" step="0.1" value="1">
                <span id="opacityValue">1</span>
            </div>
            
            <div class="settings-group">
                <label>Tag Presets</label>
                <div class="tag-color-examples">
                    <small>Use colors: <span class="color-example red">#[RED]</span> <span class="color-example green">#[GREEN]</span> <span class="color-example blue">#[BLUE]</span> <span class="color-example yellow">#[YELLOW]</span> <span class="color-example purple">#[PURPLE]</span> <span class="color-example orange">#[ORANGE]</span> <span class="color-example gray">#[GRAY]</span> <span class="color-example pink">#[PINK]</span></small>
                </div>
                <div class="tag-presets-manager">
                    <div class="tag-preset-add">
                        <input type="text" id="newTagPreset" placeholder="e.g., #[RED]urgent or #meeting" maxlength="30">
                        <button type="button" id="addTagPresetBtn" class="btn">Add</button>
                    </div>
                    <div id="tagPresetsList" class="tag-presets-list">
                        <!-- Dynamic tag presets will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <span class="close" data-modal="about">&times;</span>
            <h2>About Tasktory</h2>
            <p><strong>Version:</strong> 0.1.2</p>
            <p><strong>Log Location:</strong> <span id="aboutLogPath">Loading...</span></p>
            <p><strong>License:</strong> MIT</p>
            <p><strong>Author:</strong> Jeonghwan Yoo &lt;planyist@gmail.com&gt;</p>
            
            <h3>How to Use</h3>
            <ul>
                <li><strong>Add Task:</strong> Click âœš or press Ctrl+N</li>
                <li><strong>Edit:</strong> Click âœï¸ icon in Actions column</li>
                <li><strong>Complete:</strong> Click âœ… icon to mark as done</li>
                <li><strong>Delete:</strong> Click ğŸ—‘ï¸ icon to remove task</li>
                <li><strong>Highlight:</strong> Click ğŸ”¶ to highlight important tasks</li>
                <li><strong>Reorder:</strong> Use â¬†ï¸â¬‡ï¸ arrows to change task order</li>
                <li><strong>Export/Import:</strong> Use ğŸ’¾ğŸ“‚ to backup/restore data</li>
                <li><strong>Tags:</strong> Use #hashtags separated by spaces (e.g., #work #urgent)</li>
                <li><strong>Notifications:</strong> Click ğŸ””/ğŸ”• to toggle task notifications</li>
            </ul>
            
            <h3>Notifications</h3>
            <ul>
                <li><strong>Auto Alerts:</strong> 1 hour and 15 minutes before deadline</li>
                <li><strong>Overdue Alert:</strong> When task passes target time</li>
                <li><strong>Toggle Per Task:</strong> Use ğŸ””/ğŸ”• button in task row</li>
                <li><strong>Default Setting:</strong> Configure in Settings âš™ï¸</li>
            </ul>
            
            <h3>Task Status</h3>
            <ul>
                <li><strong><span style="color: #664d03; background: #fff3cd; padding: 2px 6px; border-radius: 8px;">Pending</span>:</strong> Task is waiting to be started</li>
                <li><strong><span style="color: #0c5460; background: #cff4fc; padding: 2px 6px; border-radius: 8px;">In Progress</span>:</strong> Task is currently being worked on</li>
                <li><strong><span style="color: #003d6b; background: #cce5ff; padding: 2px 6px; border-radius: 8px;">Due Soon</span>:</strong> Less than 1 hour remaining</li>
                <li><strong><span style="color: #58151c; background: #f8d7da; padding: 2px 6px; border-radius: 8px;">Overdue</span>:</strong> Task has passed target time</li>
                <li><strong><span style="color: #0f5132; background: #d4edda; padding: 2px 6px; border-radius: 8px;">Completed</span>:</strong> Task has been finished</li>
            </ul>
            
            <h3>Keyboard Shortcuts</h3>
            <ul>
                <li><strong>Ctrl+N:</strong> Add new task</li>
                <li><strong>Ctrl+M:</strong> Toggle ultra-compact mode (80px width)</li>
                <li><strong>ESC:</strong> Close modal or date picker</li>
            </ul>
        </div>
    </div>

    <!-- Confirmation Modal for Complete/Delete -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <span class="close" data-modal="confirm">&times;</span>
            <h2 id="confirmModalTitle"></h2>
            <form id="confirmForm">
                <div class="form-group">
                    <label for="confirmDetails" id="confirmDetailsLabel"></label>
                    <textarea id="confirmDetails" rows="3" placeholder=""></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" id="confirmCancelBtn"></button>
                    <button type="submit" id="confirmActionBtn"></button>
                </div>
            </form>
        </div>
    </div>

    <!-- Statistics Modal -->
    <div id="statisticsModal" class="modal">
        <div class="modal-content">
            <span class="close" data-modal="statistics">&times;</span>
            <h2>Statistics (Last 30 Days)</h2>
            <div id="statisticsChart" class="statistics-chart">
                <canvas id="chartCanvas" width="850" height="300"></canvas>
            </div>
        </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="fileInput" class="hidden" accept=".json">

    <script src="renderer.js"></script>
</body>
</html>